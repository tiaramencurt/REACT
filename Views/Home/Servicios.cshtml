@{
    ViewData["Title"] = "Principal";
    bool? estadoUltimoViaje = ViewData["estadoUltimoViaje"] as bool?;
 int? idViaje = ViewData["idViaje"] as int?;
}

<div class="BotonInicio">
    @if ( idViaje== null && (estadoUltimoViaje == null || estadoUltimoViaje == false ))
    {
        <a href='@Url.Action("CrearViaje", "Home", new { IdUsuario = 1 })'>Crear viaje</a>
    }
    else
    {
        <a href='@Url.Action("FinalizarViaje", "Home", new { IdViaje = idViaje })'>Finalizar viaje</a>
         <button type="button" onclick="pedirUbicacion()">Enviar ubicaci√≥n</button>
        
        
         <form id="formUbicacion" action="/Home/GuardarUbicacion" method="post">
    <input type="hidden" id="Latitud" name="Latitud">
    <input type="hidden" id="Longitud" name="Longitud">
    <input type="hidden" id="IdViaje" name="IdViaje">
</form>
    }
    
</div>

<script>
function pedirUbicacion() {
    if (navigator.geolocation) {
        // Dispara el cartel del navegador para pedir permiso
        navigator.geolocation.getCurrentPosition(
            function (position) {
            document.getElementById("Latitud").value = position.coords.latitude;
            document.getElementById("Longitud").value = position.coords.longitude;
            document.getElementById("IdViaje").value = @idViaje;

            // üìç Llamamos al m√©todo del controller enviando el form
            document.getElementById("formUbicacion").submit();
            },
            function (error) {
                alert("No se pudo obtener la ubicaci√≥n o fue denegada.");
            }
        );
    } else {
        alert("Tu navegador no soporta geolocalizaci√≥n.");
    }
}
</script>